/**
 * AIæç¤ºè¯ç®¡ç†æ¨¡å— v3.0 ç²¾ç®€ç‰ˆ
 * ç®€åŒ–æç¤ºè¯,ä¾èµ–æ¨¡å‹è‡ªèº«èƒ½åŠ›,åªä¿ç•™æ ¼å¼è¦æ±‚
 */

/**
 * è½¬ä¹‰å¯èƒ½ç ´åæç¤ºè¯ç»“æ„çš„ç‰¹æ®Šå­—ç¬¦
 */
function escapePromptContent(content: string): string {
  const jsonString = JSON.stringify(content);
  const escapedContent = jsonString.slice(1, -1);
  return escapedContent
    .replace(/\$\{/g, '\\${')
    .replace(/<\/script>/gi, '<\\/script>')
    .replace(/```/g, '\\`\\`\\`');
}

/**
 * ç”Ÿæˆå°çº¢ä¹¦çƒ­é—¨ç¬”è®°åˆ†ææç¤ºè¯
 */
export const getAnalysisPrompt = (scrapedContent: string): string => {
  const safeContent = escapePromptContent(scrapedContent);
  return `ä½ æ˜¯å°çº¢ä¹¦å†…å®¹åˆ†æå¸ˆ,åˆ†æä»¥ä¸‹çƒ­é—¨ç¬”è®°,æå–çˆ†æ¬¾è§„å¾‹ã€‚

**çƒ­é—¨ç¬”è®°æ•°æ®:**
${safeContent}

**è¾“å‡ºè¦æ±‚:**
ä¸¥æ ¼æŒ‰JSONæ ¼å¼è¾“å‡º,ä¸è¦ä»»ä½•é¢å¤–æ–‡å­—ã€‚

{
  "titleFormulas": {
    "analysis": "æ ‡é¢˜å¸¸ç”¨æ¨¡å¼",
    "suggestedFormulas": ["å…¬å¼1", "å…¬å¼2"],
    "commonKeywords": [],
    "avoidWords": []
  },
  "contentStructure": {
    "openingHooks": ["å¼€å¤´æ–¹å¼1", "å¼€å¤´æ–¹å¼2"],
    "storyTemplates": ["æ¨¡æ¿1", "æ¨¡æ¿2"],
    "bodyTemplate": "æ­£æ–‡ç»„ç»‡æ¨¡æ¿",
    "endingHooks": ["ç»“å°¾æ–¹å¼1", "ç»“å°¾æ–¹å¼2"],
    "emotionalTone": "æƒ…æ„ŸåŸºè°ƒ"
  },
  "tagStrategy": {
    "strategy": "æ ‡ç­¾ç»„åˆç­–ç•¥",
    "commonTags": [],
    "tagCategories": {
      "coreKeywords": [],
      "longTailKeywords": [],
      "sceneTags": [],
      "demographicTags": []
    }
  },
  "coverStyleAnalysis": {
    "commonStyles": ["é£æ ¼1", "é£æ ¼2"],
    "suggestion": "å»ºè®®",
    "colorTone": "è‰²è°ƒåå¥½"
  },
  "engagingWritingElements": {
    "humorTechniques": [],
    "storyElements": [],
    "emotionalHooks": []
  },
  "writingGuidelines": {
    "antiListingRules": [],
    "lifelikeDetails": []
  },
  "engagementPatterns": {
    "interactionTriggers": [],
    "commentPatterns": [],
    "shareReasons": []
  }
}

**é‡è¦:**
- åªè¿”å›JSON,æ— å…¶ä»–æ–‡æœ¬
- ä¸ç¡®å®šçš„ä¿¡æ¯è¿”å›ç©ºå€¼
- ç¦æ­¢ç¼–é€ ä¿¡æ¯`;
};

/**
 * ç”Ÿæˆå°çº¢ä¹¦æ–‡æ¡ˆåˆ›ä½œæç¤ºè¯
 */
export const getGenerationPrompt = (
  hotPostRules: string,
  userInfo: string,
  keyword: string
): string => {
  return `ä½ æ˜¯å°çº¢ä¹¦çˆ†æ¬¾åšä¸»,åŸºäºç”¨æˆ·ç´ æåˆ›ä½œä¸€ç¯‡é«˜è´¨é‡ç¬”è®°ã€‚

**çˆ†æ¬¾è§„å¾‹(å†…åŒ–åä½¿ç”¨,ä¸è¦è¾“å‡º):**
${hotPostRules}

**ç”¨æˆ·ç´ æ:**
${userInfo}

**å…³é”®è¯:** ${keyword}

**æ ¸å¿ƒè¦æ±‚:**
1. å†…å®¹å¿…é¡»åŸºäºç”¨æˆ·ç´ æ,ä¸è¦ç¼–é€ 
2. è¯­è¨€è‡ªç„¶å£è¯­åŒ–,é¿å…AIå‘³
3. æ ‡é¢˜â‰¤20å­—
4. æ­£æ–‡450-750å­—
5. æ ‡ç­¾10-15ä¸ª

**å†™ä½œé£æ ¼:**
- ç”¨å£è¯­åŒ–è¡¨è¾¾,é¿å…ä¹¦é¢è¯­
- å¤šç”¨çŸ­å¥ã€emoji
- åŠ å…¥çœŸå®ç»†èŠ‚å’Œæƒ…ç»ª
- é¿å…:é¦–å…ˆã€å…¶æ¬¡ã€æ€»ä¹‹ç­‰æ¨¡æ¿è¯

**æ ¼å¼ç¦ä»¤ï¼ˆä¸¥æ ¼æ‰§è¡Œï¼‰:**
- âŒ ç¦æ­¢ä½¿ç”¨ Markdown è¯­æ³•
- âŒ ç¦æ­¢ä½¿ç”¨ä»»ä½•æ˜Ÿå·æ ‡è®°ï¼š**åŠ ç²—**ã€*æ–œä½“*
- âŒ ç¦æ­¢ä½¿ç”¨æ–¹æ‹¬å·æ ‡è®°ï¼š[æ–‡æœ¬]ã€[é“¾æ¥]
- âŒ ç¦æ­¢ä½¿ç”¨ä»»ä½•æ ¼å¼åŒ–ç¬¦å·ï¼š* [ ] ( )
- âŒ é¿å…ç»å¯¹åŒ–è¯è¯­ï¼šæœ€ã€ç¬¬ä¸€ã€å”¯ä¸€ã€100%ã€ä¿è¯ç­‰
- âœ… ä»…è¾“å‡ºçº¯æ–‡æœ¬å†…å®¹ï¼Œä¸å¸¦ä»»ä½•æ ¼å¼æ ‡è®°
- âœ… å¦‚éœ€å¼ºè°ƒï¼Œç”¨"çœŸçš„"ã€"è¶…çº§"ç­‰å£è¯­åŒ–è¯æ±‡
- âœ… ç”¨"å¾ˆ"ã€"éå¸¸"ã€"ç‰¹åˆ«"ä»£æ›¿ç»å¯¹åŒ–è¡¨è¾¾

**ç›´æ¥è¾“å‡ºä»¥ä¸‹æ ¼å¼,ä¸è¦ä»»ä½•å‰å¯¼æ–‡å­—:**

## 1. çˆ†æ¬¾æ ‡é¢˜åˆ›ä½œ(3ä¸ª)
(æ¯ä¸ªæ ‡é¢˜â‰¤20å­—,emojiè®¡2å­—)
- æ ‡é¢˜1:
- æ ‡é¢˜2:
- æ ‡é¢˜3:

## 2. æ­£æ–‡å†…å®¹
(100-400å­—,åŸºäºç”¨æˆ·ç´ æ,è‡ªç„¶å£è¯­åŒ–,åŒ…å«çœŸå®ç»†èŠ‚ã€‚**é‡è¦:æ­£æ–‡ä¸­ç¦æ­¢å‡ºç°ä»»ä½•æ ‡ç­¾,ä¸è¦ç”¨ #æ ‡ç­¾å æ ¼å¼**)

## 3. å…³é”®è¯æ ‡ç­¾(10-15ä¸ª)
(æ ‡ç­¾ç”Ÿæˆç­–ç•¥ï¼š
- æŒ‰æ ¸å¿ƒè¯+é•¿å°¾è¯+åœºæ™¯è¯+äººç¾¤è¯ç»„åˆï¼Œä½†ä»…ä¿ç•™ä¸ç´ æå¼ºç›¸å…³çš„é¡¹
- ä¸¥æ ¼å»é‡ï¼Œé¿å…åŒä¹‰è¯å †ç Œ
- ä¸è¦æœºæ¢°å¥—ç”¨"#å¹³ä»·å¥½ç‰©""#å­¦ç”Ÿå…š"ç­‰å¸¸è§è¯ï¼Œé™¤éç´ æç¡®å®è´´åˆ
- ç¡®ä¿æ¯ä¸ªæ ‡ç­¾éƒ½ä¸å†…å®¹æœ‰æ˜ç¡®å…³è”ï¼Œé¿å…ä¸ºäº†å‡‘æ•°è€Œæ·»åŠ æ— å…³æ ‡ç­¾
- æ ‡ç­¾æ•°é‡æ§åˆ¶åœ¨10-15ä¸ªä¹‹é—´ï¼Œä¼˜å…ˆä¿ç•™ç›¸å…³æ€§é«˜çš„æ ‡ç­¾)

## 4. AIç»˜ç”»æç¤ºè¯
(ä»»åŠ¡ï¼šå°†æ­£æ–‡æç‚¼ä¸ºæ ¸å¿ƒå–ç‚¹ã€‚
è¦æ±‚ï¼š
1.  è¯·ä¸¥æ ¼åŸºäºæ­£æ–‡å†…å®¹è¿›è¡Œæç‚¼ï¼Œä¸æ·»åŠ æˆ–è‡†é€ æ–°ä¿¡æ¯ã€‚
2.  æ ¸å¿ƒå–ç‚¹æç‚¼æ ‡å‡†ï¼š
    *   **æ˜ç¡®ä»·å€¼**ï¼šå¿…é¡»æ¸…æ™°ä¼ è¾¾èƒ½ç»™ç”¨æˆ·å¸¦æ¥çš„å…·ä½“å¥½å¤„æˆ–è§£å†³æ–¹æ¡ˆï¼ˆå¦‚â€œç¾ç™½â€ã€â€œçœæ—¶â€ã€â€œé«˜æ•ˆâ€ï¼‰ã€‚
    *   **å¼•å‘å…±é¸£**ï¼šéœ€æˆ³ä¸­ç›®æ ‡ç”¨æˆ·çš„ç—›ç‚¹æˆ–æ ¸å¿ƒæ¬²æœ›ï¼ˆå¦‚â€œç†¬å¤œè„¸æ•‘æ˜Ÿâ€ã€â€œæ‡’äººå¿…å¤‡â€ï¼‰ã€‚
    *   **å·®å¼‚åŒ–**ï¼šçªå‡ºäº§å“ã€æœåŠ¡æˆ–å†…å®¹ç›¸è¾ƒäºåŒç±»ç«å“çš„ç‹¬ç‰¹ä¼˜åŠ¿ã€‚
3.  å°çº¢ä¹¦å°é¢æ–‡æ¡ˆåˆ›ä½œæ ‡å‡†ï¼š
    *   **å¥å¼ç®€æ´æœ‰åŠ›**ï¼šå­—æ•°å»ºè®®æ§åˆ¶åœ¨10-15å­—ä»¥å†…ï¼Œæ˜“äºå¿«é€Ÿé˜…è¯»ã€‚
    *   **å…³é”®è¯å‰ç½®**ï¼šå°†æœ€å…·å¸å¼•åŠ›çš„æ ¸å¿ƒè¯ï¼ˆå¦‚â€œå·¨æ˜¾ç™½â€ã€â€œé—­çœ¼å…¥â€ï¼‰ç½®äºå¼€å¤´ã€‚
    *   **å¤šç”¨ç¬¦å·ä¸æƒ…ç»ªè¯**ï¼šå¯é…Œæƒ…ä½¿ç”¨â€œâ—â€ã€â€œğŸ”¥â€ã€â€œç»äº†ï¼â€ç­‰ç¬¦å·å’Œç½‘ç»œæµè¡Œè¯­å¢å¼ºè§†è§‰å†²å‡»åŠ›å’Œæƒ…ç»ªæ„ŸæŸ“åŠ›ã€‚
    *   **é¿å…å¤æ‚å¥å¼ä¸ä¸“ä¸šæœ¯è¯­**ï¼Œç¡®ä¿æ–‡æ¡ˆå£è¯­åŒ–ã€ç¤¾äº¤åŒ–ã€‚
4.  æœ€ç»ˆè¾“å‡ºåªéœ€å‘ˆç°æç‚¼å¹¶ä¼˜åŒ–åçš„å°çº¢ä¹¦å°é¢æ–‡æ¡ˆæœ¬èº«ï¼Œæ— éœ€è§£é‡Šæˆ–ä¿ç•™åŸå§‹æ–‡æ¡ˆå†…å®¹ã€‚)

## 5. é¦–è¯„å…³é”®è¯å¼•å¯¼
(è¡¥å……æ­£æ–‡ä¸­æœªè¯´æ˜çš„å…³é”®ä¿¡æ¯,å¼•å¯¼äº’åŠ¨)

## 6. å‘å¸ƒç­–ç•¥å»ºè®®
(å»ºè®®æœ€ä½³å‘å¸ƒæ—¶é—´æ®µ)

## 7. å°çº¢ä¹¦å¢é•¿ Playbook
- **æ ¸å¿ƒä»·å€¼å®šä½:** [å®ç”¨ä»·å€¼/æƒ…ç»ªä»·å€¼]
- **åˆå§‹æµé‡æ± ç­–ç•¥:** [å…·ä½“å»ºè®®]
- **æ•°æ®é©±åŠ¨ä¼˜åŒ–:**
  - ç‚¹å‡»ç‡ > 10%?
  - äº’åŠ¨ç‡ > 3%?
  - èµè—æ¯”å¥åº·?
`;
};
